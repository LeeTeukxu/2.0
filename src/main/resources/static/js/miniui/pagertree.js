mini.PagerTree=function(){mini.PagerTree.superclass.constructor.call(this),mini.addClass(this.el,"mini-tree"),mini.addClass(this.el,"mini-treegrid"),this._Expander=new mini._PagerTree_Expander(this),this._collapseNodes=[],this.on("beforeload",this.__OnBeforeLoad,this)},mini.extend(mini.PagerTree,mini.DataGrid,{uiCls:"mini-pagertree",treeColumn:"",idField:"id",showTreeIcon:!0,iconField:"iconCls",imgField:"img",imgPath:"",leafIconCls:"mini-tree-leaf",folderIconCls:"mini-tree-folder",_expandNodeCls:"mini-tree-expand",_collapseNodeCls:"mini-tree-collapse",_eciconCls:"mini-tree-node-ecicon",_OnCellMouseDown:function(e){mini.findParent(e.htmlEvent.target,this._eciconCls)||mini.findParent(e.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellmousedown",e)},_OnCellClick:function(e){mini.findParent(e.htmlEvent.target,this._eciconCls)||mini.findParent(e.htmlEvent.target,"mini-tree-checkbox")||this.fire("cellclick",e)},_OnDrawCell:function(e,t,n,r){var i=mini.PagerTree.superclass._OnDrawCell.call(this,e,t,n,r);return this.treeColumn&&this.treeColumn==t.name&&(i.headerCls+=" mini-tree-treecolumn",i.cellCls+=" mini-tree-treecell",i.cellStyle+=";padding:0;vertical-align:top;",i.img=e[this.imgField],i.iconCls=this._getNodeIcon(e),i.showTreeIcon=this.showTreeIcon,i.nodeCls="",i.nodeStyle="",this._createTreeCell(i)),i},_createTreeCell:function(e){var t=[],n=e.record,r=this.isLeafNode(n),i=this.getNodeLevel(n),o=this.isExpandedNode(n),a=e.nodeCls;r||(a=o?this._expandNodeCls:this._collapseNodeCls),r||(a+=" mini-tree-parentNode"),t[t.length]='<div class="mini-tree-nodetitle '+a+'" style="'+e.nodeStyle+'">';for(var s=0,u=s;i-1>u;u++)t[t.length]='<span class="mini-tree-indent " ></span>';if(r?t[t.length]='<span class="'+this._eciconCls+'" ></span>':t[t.length]='<a class="'+this._eciconCls+'"  href="javascript:void(0);" onclick="return false;" hidefocus></a>',t[t.length]='<span class="mini-tree-nodeshow">',e.showTreeIcon)if(e.img){var l=this.imgPath+e.img;t[t.length]='<span class="mini-tree-icon mini-icon" style="background-image:url('+l+');"></span>'}else t[t.length]='<span class="'+e.iconCls+' mini-tree-icon mini-icon"></span>';t[t.length]='<span class="mini-tree-nodetext">',t[t.length]=e.cellHtml,t[t.length]="</span>",t[t.length]="</span>",t[t.length]="</div>",e.cellHtml=t.join("")},__OnBeforeLoad:function(e){var t={collapseNodes:this._collapseNodes};e.data.__ecconfig=mini.encode(t)},load:function(){return this._collapseNodes=[],mini.PagerTree.superclass.load.apply(this,arguments)},expandNode:function(e){"object"==typeof e&&(e=e[this.idField]),this._collapseNodes.remove(e),this.reload()},collapseNode:function(e){"object"==typeof e&&(e=e[this.idField]),this._collapseNodes.remove(e),this._collapseNodes.add(e),this.reload()},toggleNode:function(e){this.isExpandedNode(e)?this.collapseNode(e):this.expandNode(e)},collapseNodes:function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];this._collapseNodes.remove(r),this._collapseNodes.add(r)}this.reload()},expandNodes:function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];this._collapseNodes.remove(r)}this.reload()},collapseAll:function(){var e=this.getResultObject().allIds||[];this._collapseNodes.length=0,this._collapseNodes.addRange(e),console.log(this._collapseNodes),this.reload()},expandAll:function(){this._collapseNodes.length=0,this.reload()},isExpandedNode:function(e){return"object"==typeof e&&(e=e[this.idField]),-1==this._collapseNodes.indexOf(e)},isLeafNode:function(e){return e.isLeaf},getNodeLevel:function(e){return e._level},_getNodeIcon:function(e){var t=e[this.iconField];return t||(t=this.isLeafNode(e)?this.leafIconCls:this.folderIconCls),t},getAttrs:function(e){var t=mini.PagerTree.superclass.getAttrs.call(this,e);return mini._ParseString(e,t,["treeColumn","iconField","imgField","imgPath","idField"]),mini._ParseBool(e,t,["showTreeIcon","expandOnLoad"]),t}}),mini.regClass(mini.PagerTree,"pagertree"),mini._PagerTree_Expander=function(e){this.owner=e,mini.on(e.el,"click",this.__OnClick,this)},mini._PagerTree_Expander.prototype={__OnClick:function(e){var t=this.owner,n=t.getRecordByEvent(e,!1);if(n){t.isLeafNode(n);if(mini.findParent(e.target,t._eciconCls)){if(t.isLeafNode(n))return;t.toggleNode(n[t.idField])}}}};